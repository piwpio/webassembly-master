"use strict";(self.webpackChunkwebassembly_master=self.webpackChunkwebassembly_master||[]).push([[501],{8501:(le,T,l)=>{l.r(T),l.d(T,{ImageModule:()=>se});var f=l(9808);const _=["js","wasm"],S=(n,a)=>{for(let t=0;t<a;t+=4)n[t]=255-n[t],n[t+1]=255-n[t+1],n[t+2]=255-n[t+2]},w=(n,a)=>{for(let t=0;t<a;t+=4){const s=(n[t]+n[t+1]+n[t+2])/3;n[t]=s,n[t+1]=s,n[t+2]=s}},O=(n,a)=>{for(let t=0;t<a;t+=4){const s=.393*n[t]+.769*n[t+1]+.189*n[t+2],i=.349*n[t]+.686*n[t+1]+.168*n[t+2],o=.272*n[t]+.534*n[t+1]+.131*n[t+2];n[t]=s<255?s:255,n[t+1]=i<255?i:255,n[t+2]=o<255?o:255}};var y=l(7625),j=l(5529),J=l(3753),U=l(2916),c=l(5832),e=l(5e3),P=l(2547),x=l(1271),Z=l(7423),R=l(5245),C=l(4106),A=l(7531),I=l(4107),B=l(508),r=l(6346),p=l(1091);const D=["canvasOriginal"],N=["canvasJs"],Q=["canvasWasm"],W=["fileInput"];function k(n,a){if(1&n&&(e.TgZ(0,"div",22)(1,"div"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij("Width: ",null==t.image?null:t.image.width,""),e.xp6(2),e.hij("Height: ",null==t.image?null:t.image.height,"")}}function Y(n,a){1&n&&(e.TgZ(0,"div",23),e._uU(1,"No results"),e.qZA())}function G(n,a){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Test No."),e.qZA())}function H(n,a){if(1&n&&(e.TgZ(0,"td",40),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.hij("",t.testNo+1,".")}}function F(n,a){1&n&&(e.TgZ(0,"th",39),e._uU(1,"JS"),e.qZA())}function $(n,a){if(1&n&&(e.TgZ(0,"td",40),e._uU(1),e.qZA()),2&n){const t=a.$implicit,s=e.oxw(2);e.Tol(s.getRowClass(t.js,s.allResults.combined)),e.xp6(1),e.hij(" ",t.js,"ms ")}}function E(n,a){1&n&&(e.TgZ(0,"th",39),e._uU(1,"WASM"),e.qZA())}function q(n,a){if(1&n&&(e.TgZ(0,"td",40),e._uU(1),e.qZA()),2&n){const t=a.$implicit,s=e.oxw(2);e.Tol(s.getRowClass(t.wasm,s.allResults.combined)),e.xp6(1),e.hij(" ",t.wasm,"ms ")}}function z(n,a){1&n&&e._UZ(0,"tr",41)}function L(n,a){1&n&&e._UZ(0,"tr",42)}function V(n,a){if(1&n&&e._UZ(0,"ngx-charts-number-card",43),2&n){const t=a.$implicit,s=e.oxw(2);e.Q6J("results",s.chartBlockResults[t])("cardColor","#000")}}function X(n,a){if(1&n&&(e.TgZ(0,"div",24)(1,"table",25),e.ynx(2,26),e.YNc(3,G,2,0,"th",27),e.YNc(4,H,2,1,"td",28),e.BQk(),e.ynx(5,29),e.YNc(6,F,2,0,"th",27),e.YNc(7,$,2,3,"td",30),e.BQk(),e.ynx(8,31),e.YNc(9,E,2,0,"th",27),e.YNc(10,q,2,3,"td",30),e.BQk(),e.YNc(11,z,1,0,"tr",32),e.YNc(12,L,1,0,"tr",33),e.qZA(),e.TgZ(13,"div",34)(14,"div",35),e.YNc(15,V,1,2,"ngx-charts-number-card",36),e.qZA(),e.TgZ(16,"div",37),e._UZ(17,"ngx-charts-bar-vertical-2d",38),e.qZA()()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.tablePreparedResults),e.xp6(10),e.Q6J("matHeaderRowDef",t.tableDisplayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.tableDisplayedColumns),e.xp6(3),e.Q6J("ngForOf",t.imageTests),e.xp6(2),e.Q6J("results",t.chartBarsResults)("legend",!0)("yAxisLabel","time [ms]")("showYAxisLabel",!0)("xAxis",!0)("yAxis",!0)}}let K=(()=>{class n{constructor(t,s,i){this.webassemblyService=t,this.chRef=s,this.matSnackBar=i,this.isReady=!1,this.isRunning=!1,this.getRowClass=c.gT,this.imageTests=_,this.tableDisplayedColumns=["testNo",..._],this.tablePreparedResults=null,this.chartBlockResults=null,this.chartBarsResults=null,this.allResults=null,this.testSuites={},this.allTestSuites={},this.destroy$=new j.xQ}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}ngAfterViewInit(){const t=this.fileInputRef.nativeElement;(0,J.R)(t,"change").pipe((0,y.R)(this.destroy$)).subscribe(()=>{this.readImageFile(t.files[0])}),this.ctxOriginal=this.canvasOriginal.nativeElement.getContext("2d"),this.ctxJs=this.canvasJs.nativeElement.getContext("2d"),this.ctxWasm=this.canvasWasm.nativeElement.getContext("2d"),this.allTestSuites.jsGrayscale=w,this.allTestSuites.jsInvert=S,this.allTestSuites.jsSephia=O,this.webassemblyService.initWasm("/assets/scripts/image/image.wasm").then(s=>{this.wasmMemory=s.instance.exports.memory,this.allTestSuites.wasmGrayscale=s.instance.exports.grayscale,this.allTestSuites.wasmInvert=s.instance.exports.invert,this.allTestSuites.wasmSephia=s.instance.exports.sephia,this.prepareImage()})}runTest(t,s){this.areInputsValid(s)?(this.tablePreparedResults=null,this.isRunning=!0,this.chRef.markForCheck(),setTimeout(()=>{this.test(t,s).pipe((0,y.R)(this.destroy$)).subscribe(i=>{this.isRunning=!1,this.prepareResults(t,i),this.chRef.markForCheck()})},500)):this.matSnackBar.open("Invalid inputs")}test(t,s){return new U.y(i=>{this.testSuites={js:this.allTestSuites[`js${s}`],wasm:this.allTestSuites[`wasm${s}`]};const o={};for(const m of _){o[m]=[];const u=m.indexOf("wasm")>-1,g=this.testSuites[m];for(let h=0;h<t;h++){const d=this.ctxOriginal.getImageData(0,0,this.canvasOriginal.nativeElement.width,this.canvasOriginal.nativeElement.height);let ne=0;const ae=performance.now();let v;if(u){const ie=performance.now();v=new Uint8ClampedArray(this.wasmMemory.buffer,0,d.data.length),v.set(d.data),ne=performance.now()-ie}else v=d.data;g(u?0:v,v.length),d.data.set(v);const M=u?this.ctxWasm:this.ctxJs;this.prepareCanvas(M),M.putImageData(d,0,0);let b=performance.now()-ae;0===b&&(b=1e-12),o[m].push((0,c.Xp)(b))}}i.next(o)})}readImageFile(t){this.prepareImage(URL.createObjectURL(t))}prepareImage(t){this.isReady=!1;const s=new Image;s.onload=()=>{this.image=s,s.style.display="none",this.prepareCanvas(this.ctxOriginal),this.ctxOriginal.drawImage(s,0,0),this.isReady=!0,this.chRef.markForCheck()},s.src=null!=t?t:"/assets/images/niceView.jpeg"}prepareCanvas(t){t.canvas.width=this.image.width,t.canvas.height=this.image.height}prepareResults(t,s){var i,o,m,u;this.chartBlockResults={js:[{name:"Best JS",value:(0,c.oq)(s.js)},{name:"Worst JS",value:(0,c.dm)(s.js)},{name:"Average JS",value:(0,c.A5)(s.js)},{name:"Median JS",value:(0,c.rV)(s.js)}],wasm:[{name:"Best WASM",value:(0,c.oq)(s.wasm)},{name:"Worst WASM",value:(0,c.dm)(s.wasm)},{name:"Average WASM",value:(0,c.A5)(s.wasm)},{name:"Median WASM",value:(0,c.rV)(s.wasm)}]},this.chartBarsResults=[{name:"Best",series:[{name:"JS",value:this.chartBlockResults.js[0].value},{name:"WASM",value:this.chartBlockResults.wasm[0].value}]},{name:"Worst",series:[{name:"JS",value:this.chartBlockResults.js[1].value},{name:"WASM",value:this.chartBlockResults.wasm[1].value}]},{name:"Average",series:[{name:"JS",value:this.chartBlockResults.js[2].value},{name:"WASM",value:this.chartBlockResults.wasm[2].value}]},{name:"Median",series:[{name:"JS",value:this.chartBlockResults.js[3].value},{name:"WASM",value:this.chartBlockResults.wasm[3].value}]}],this.allResults=Object.assign(s,{combined:[...s.js,...s.wasm]});const g=[];for(let h=0;h<t;h++)g.push({testNo:h,js:null!==(o=null===(i=null==s?void 0:s.js)||void 0===i?void 0:i[h])&&void 0!==o?o:-1,wasm:null!==(u=null===(m=null==s?void 0:s.wasm)||void 0===m?void 0:m[h])&&void 0!==u?u:-1});this.tablePreparedResults=g}areInputsValid(t){return!0}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(P.g),e.Y36(e.sBO),e.Y36(x.ux))},n.\u0275cmp=e.Xpm({type:n,selectors:[["image"]],viewQuery:function(t,s){if(1&t&&(e.Gf(D,5),e.Gf(N,5),e.Gf(Q,5),e.Gf(W,5)),2&t){let i;e.iGM(i=e.CRH())&&(s.canvasOriginal=i.first),e.iGM(i=e.CRH())&&(s.canvasJs=i.first),e.iGM(i=e.CRH())&&(s.canvasWasm=i.first),e.iGM(i=e.CRH())&&(s.fileInputRef=i.first)}},decls:42,vars:13,consts:[[1,"form__container"],["mat-mini-fab","","color","primary",1,"button__image",3,"disabled","click"],["type","file","accept","image/*",2,"display","none"],["fileInput",""],[3,"submit"],["appearance","outline"],["matInput","","type","number","min","1","max","10","value","10",3,"disabled"],["inputTestsNo",""],[3,"disabled","value"],["alghoritm",""],[3,"value"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[1,"canvas__source--container"],["canvasOriginal",""],["class","size",4,"ngIf"],["class","no-results-container",4,"ngIf"],[1,"result-container__canvas"],[1,"canvas__container"],[1,"canvas__result"],["canvasJs",""],["canvasWasm",""],["class","results-container",4,"ngIf"],[1,"size"],[1,"no-results-container"],[1,"results-container"],["mat-table","",1,"mat-elevation-z2",3,"dataSource"],["matColumnDef","testNo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","js"],["mat-cell","",3,"class",4,"matCellDef"],["matColumnDef","wasm"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"charts__container"],[1,"chart__container--card"],[3,"results","cardColor",4,"ngFor","ngForOf"],[1,"chart__container--bar"],[3,"results","legend","yAxisLabel","showYAxisLabel","xAxis","yAxis"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[3,"results","cardColor"]],template:function(t,s){if(1&t){const i=e.EpF();e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return e.CHM(i),e.MAs(5).click()}),e.TgZ(2,"mat-icon"),e._uU(3,"add_a_photo"),e.qZA()(),e._UZ(4,"input",2,3),e.TgZ(6,"form",4),e.NdJ("submit",function(m){e.CHM(i);const u=e.MAs(11),g=e.MAs(16);return m.preventDefault(),s.runTest(+u.value,g.value)}),e.TgZ(7,"mat-form-field",5)(8,"mat-label"),e._uU(9,"Number of tests"),e.qZA(),e._UZ(10,"input",6,7),e.qZA(),e.TgZ(12,"mat-form-field",5)(13,"mat-label"),e._uU(14,"Algorithm"),e.qZA(),e.TgZ(15,"mat-select",8,9)(17,"mat-option",10),e._uU(18,"Grayscale"),e.qZA(),e.TgZ(19,"mat-option",10),e._uU(20,"Invert"),e.qZA(),e.TgZ(21,"mat-option",10),e._uU(22,"Sephia"),e.qZA()()(),e.TgZ(23,"button",11),e._uU(24,"Run benchmark"),e.qZA()()(),e.TgZ(25,"div",12),e._UZ(26,"canvas",null,13),e.YNc(28,k,5,2,"div",14),e.qZA(),e.YNc(29,Y,2,0,"div",15),e.TgZ(30,"div",16)(31,"div",17)(32,"div"),e._uU(33,"JS image results"),e.qZA(),e._UZ(34,"canvas",18,19),e.qZA(),e.TgZ(36,"div",17)(37,"div"),e._uU(38,"WASM image results"),e.qZA(),e._UZ(39,"canvas",18,20),e.qZA()(),e.YNc(41,X,18,10,"div",21)}2&t&&(e.xp6(1),e.Q6J("disabled",!s.isReady||s.isRunning),e.xp6(9),e.Q6J("disabled",!s.isReady||s.isRunning),e.xp6(5),e.Q6J("disabled",!s.isReady||s.isRunning)("value","Grayscale"),e.xp6(2),e.Q6J("value","Grayscale"),e.xp6(2),e.Q6J("value","Invert"),e.xp6(2),e.Q6J("value","Sephia"),e.xp6(2),e.Q6J("disabled",!s.isReady||s.isRunning),e.xp6(5),e.Q6J("ngIf",(null==s.image?null:s.image.width)&&(null==s.image?null:s.image.height)),e.xp6(1),e.Q6J("ngIf",!s.isRunning&&0===(null==s.tablePreparedResults?null:s.tablePreparedResults.length)),e.xp6(1),e.ekj("visible",!s.isRunning&&(null==s.tablePreparedResults?null:s.tablePreparedResults.length)),e.xp6(11),e.Q6J("ngIf",!s.isRunning&&(null==s.tablePreparedResults?null:s.tablePreparedResults.length)))},directives:[Z.lW,R.Hw,C.KE,C.hX,A.Nt,I.gD,B.ey,f.O5,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk,f.sg,p.vg,p.H5],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.form__container[_ngcontent-%COMP%]   .button__image[_ngcontent-%COMP%]{top:-8px;right:10px}.canvas__source--container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center}.canvas__source--container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:50%}.canvas__source--container[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{position:absolute;right:10%}.result-container__canvas[_ngcontent-%COMP%]{visibility:hidden;display:flex}.result-container__canvas.visible[_ngcontent-%COMP%]{visibility:visible}.result-container__canvas[_ngcontent-%COMP%]   .canvas__container[_ngcontent-%COMP%]{position:relative;display:flex;width:50%;flex-direction:column}.result-container__canvas[_ngcontent-%COMP%]   .canvas__container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;font-size:1.2em}.result-container__canvas[_ngcontent-%COMP%]   .canvas__container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:98%;padding:1%}"],changeDetection:0}),n})();var ee=l(8555);const te=[{path:"",component:K}];let se=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[f.ez,ee.Bz.forChild(te),x.ZX,C.lN,I.LD,A.c,Z.ot,p.eC,p.pT,r.p0,R.Ps]]}),n})()}}]);